CREATE DATABASE SQL_QLKTX
USE SQL_QLKTX
SET DATEFORMAT dmy;
CREATE TABLE TOANHA
(
	MATOA VARCHAR(10) NOT NULL PRIMARY KEY,
	TENTOA VARCHAR(20) 
)

INSERT INTO TOANHA(MATOA , TENTOA) VALUES ('A' ,N'Toa A');
INSERT INTO TOANHA(MATOA , TENTOA) VALUES ('B' ,N'Toa B');
INSERT INTO TOANHA(MATOA , TENTOA) VALUES ('C' ,N'Toa C');
INSERT INTO TOANHA(MATOA , TENTOA) VALUES ('D' ,N'Toa D');

CREATE TABLE PHONGSV
(
	MAPHONG VARCHAR(10) NOT NULL PRIMARY KEY,
	TENPHONG NVARCHAR(50),
	LOAIPHONG NVARCHAR(30),
	SOLUONG INT,
	GIAPHONG FLOAT,
	TRANGTHAI NVARCHAR(30),
	MATOA VARCHAR(10),
	FOREIGN KEY(MATOA) REFERENCES TOANHA(MATOA)
)

INSERT INTO PHONGSV(MAPHONG, TENPHONG, LOAIPHONG, SOLUONG, GIAPHONG, TRANGTHAI, MATOA) VALUES ('A01' ,N'Phòng 1', N'Phòng 2', 2, 800000, N'Đang Còn Trống', 'A');
INSERT INTO PHONGSV(MAPHONG, TENPHONG, LOAIPHONG, SOLUONG, GIAPHONG, TRANGTHAI, MATOA) VALUES ('A02' ,N'Phòng 2', N'Phòng 4', 4, 600000, N'Đang Còn Trống', 'A');
INSERT INTO PHONGSV(MAPHONG, TENPHONG, LOAIPHONG, SOLUONG, GIAPHONG, TRANGTHAI, MATOA) VALUES ('B01' ,N'Phòng 1', N'Phòng 6', 6, 400000, N'Đang Còn Trống', 'B');
INSERT INTO PHONGSV(MAPHONG, TENPHONG, LOAIPHONG, SOLUONG, GIAPHONG, TRANGTHAI, MATOA) VALUES ('B02' ,N'Phòng 2', N'Phòng 8', 8, 200000, N'Đang Còn Trống', 'B');
INSERT INTO PHONGSV(MAPHONG, TENPHONG, LOAIPHONG, SOLUONG, GIAPHONG, TRANGTHAI, MATOA) VALUES ('C01' ,N'Phòng 1', N'Phòng 2', 2, 800000, N'Đang Còn Trống', 'C');
INSERT INTO PHONGSV(MAPHONG, TENPHONG, LOAIPHONG, SOLUONG, GIAPHONG, TRANGTHAI, MATOA) VALUES ('C02' ,N'Phòng 2', N'Phòng 4', 4, 600000, N'Đang Còn Trống', 'C');
INSERT INTO PHONGSV(MAPHONG, TENPHONG, LOAIPHONG, SOLUONG, GIAPHONG, TRANGTHAI, MATOA) VALUES ('D01' ,N'Phòng 1', N'Phòng 6', 6, 400000, N'Đang Còn Trống', 'D');
INSERT INTO PHONGSV(MAPHONG, TENPHONG, LOAIPHONG, SOLUONG, GIAPHONG, TRANGTHAI, MATOA) VALUES ('D02' ,N'Phòng 2', N'Phòng 8', 8, 200000, N'Đang Còn Trống', 'D');

CREATE TABLE TRUONGHOC
(
	MATRUONG VARCHAR(20) NOT NULL PRIMARY KEY,
	TENTRUONG NVARCHAR(30)
)
INSERT INTO TRUONGHOC(MATRUONG, TENTRUONG) VALUES ('DKC' ,N'HUTECH');
INSERT INTO TRUONGHOC(MATRUONG, TENTRUONG) VALUES ('UIT' ,N'ĐẠI HỌC CNTT');
INSERT INTO TRUONGHOC(MATRUONG, TENTRUONG) VALUES ('UEF' ,N'ĐẠI HỌC KINH TẾ');


CREATE TABLE SINHVIEN
(
	CCCD VARCHAR(13) NOT NULL PRIMARY KEY,
	MSSV VARCHAR(11),
	HOTEN NVARCHAR(30),
	NAMSINH DATETIME,
	GIOITINH NVARCHAR(10),
	SDT	VARCHAR(10),
	EMAIL VARCHAR(30),
	DIACHI NVARCHAR(50),
	NGAYVAOKTX DATETIME,
	NGAYRAKTX DATETIME,
	TRANGTHAI NVARCHAR(20),
	MAPHONG VARCHAR(10),
	MATRUONG VARCHAR(20),
	FOREIGN KEY (MAPHONG) REFERENCES PHONGSV(MAPHONG),
	FOREIGN KEY (MATRUONG) REFERENCES TRUONGHOC(MATRUONG)
)
--sinh viên 1
INSERT INTO SINHVIEN(CCCD, MSSV, HOTEN, NAMSINH, GIOITINH, SDT, EMAIL, DIACHI, NGAYVAOKTX, NGAYRAKTX, TRANGTHAI, MAPHONG, MATRUONG)
VALUES ('CD1' ,'SV01', N'Nguyễn Văn A', 2001-01-29 ,N'Nam', 0327,'haunguyen',N'Hồ Chí Minh',2022-01-01 ,NULL,N'Đang Ở', 'A01','DKC');
--sinh viên 2
INSERT INTO SINHVIEN(CCCD, MSSV, HOTEN, NAMSINH, GIOITINH, SDT, EMAIL, DIACHI, NGAYVAOKTX, NGAYRAKTX, TRANGTHAI, MAPHONG, MATRUONG)
VALUES ('CD2' ,'SV02', N'Nguyễn Văn B', 2001-01-29,N'Nam', 0327,'haunguyen',N'Hồ Chí Minh',2022-01-01 ,NULL,N'Đang Ở', 'A02','DKC');

CREATE TABLE NGUOITHANSV
(
	MANT INT IDENTITY PRIMARY KEY,
	TENNGUOITHAN NVARCHAR(30),
	QUANHEVOISV NVARCHAR(10),
	SDT VARCHAR(10),
	DIACHI NVARCHAR(50),
	CCCD VARCHAR(13),
	FOREIGN KEY(CCCD) REFERENCES SINHVIEN(CCCD)
)
INSERT INTO NGUOITHANSV( TENNGUOITHAN, QUANHEVOISV, SDT, DIACHI ,CCCD) VALUES (N'Người Thân SV1', N'Mẹ',0324, N'Đắk Lắk', 'CD1')
INSERT INTO NGUOITHANSV( TENNGUOITHAN, QUANHEVOISV, SDT, DIACHI ,CCCD) VALUES (N'Người Thân SV2', N'Cha',0324, N'Đắk Lắk', 'CD2')

CREATE TABLE NOIQUYKTX
(
	MANOIQUY VARCHAR(10) NOT NULL PRIMARY KEY,
	TENNOIQUY NVARCHAR(50) NOT NULL,
	NOIDUNG NVARCHAR(50),
	HINHTHUCPHAT NVARCHAR(50)
)

CREATE TABLE NHANVIEN
(
	MANV VARCHAR(20) PRIMARY KEY,
	HOTENNV NVARCHAR(50),
	NGAYSINH DATETIME,
	GIOITINH NVARCHAR(10),
	SDT VARCHAR(10),
	DIACHI NVARCHAR(50),
	CHUCVU NVARCHAR(50),
	LUONG FLOAT,
	TRANGTHAI NVARCHAR(20)
)

INSERT INTO NHANVIEN(MANV, HOTENNV, NGAYSINH, GIOITINH, SDT, DIACHI, CHUCVU, LUONG, TRANGTHAI) 
VALUES('NV01', N'Nhân Viên 1', 2001-01-29,N'Nữ',0327, N'Hồ Chí Minh', N'Quản Lý',12000000,N'Đang Làm Việc')
--Nhân viên 2
INSERT INTO NHANVIEN(MANV, HOTENNV, NGAYSINH, GIOITINH, SDT, DIACHI, CHUCVU, LUONG, TRANGTHAI) 
VALUES('NV02', N'Nhân Viên 2', 2001-01-29,N'Nữ',0327, N'Hồ Chí Minh', N'Nhân Viên',12000000,N'Đang Làm Việc')

CREATE TABLE KYLUAT
(
	MAKYLUAT VARCHAR(20) NOT NULL PRIMARY KEY,
	CCCD VARCHAR(13),
	MANV VARCHAR(20),
	NGAYKYLUAT DATETIME  NOT NULL,
	FOREIGN KEY (CCCD) REFERENCES SINHVIEN(CCCD),
	FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)
)

CREATE TABLE CTKYLUAT
(
	ID INT IDENTITY PRIMARY KEY,
	MAKYLUAT VARCHAR(20),
	MANOIQUY VARCHAR(10),
	/*PRIMARY KEY(MAKYLUAT),*/
	FOREIGN KEY(MANOIQUY) REFERENCES NOIQUYKTX(MANOIQUY),
	FOREIGN KEY(MAKYLUAT) REFERENCES KYLUAT(MAKYLUAT)
)

CREATE TABLE BANGGIADIENNUOC
(
	MABANGGIA VARCHAR(10) NOT NULL PRIMARY KEY,
	TENDICHVU NVARCHAR(10),
	GIATHANH FLOAT
)
INSERT INTO BANGGIADIENNUOC(MABANGGIA, TENDICHVU, GIATHANH) VALUES('GIADIEN', N'GIÁ ĐIỆN',3000)
INSERT INTO BANGGIADIENNUOC(MABANGGIA, TENDICHVU, GIATHANH) VALUES('GIANUOC', N'GIÁ NƯỚC',2500)

CREATE TABLE HOADONDIENNUOC
(
	MAHDDIENNUOC INT IDENTITY PRIMARY KEY,
	/*MAHDDIENNUOC VARCHAR(10) NOT NULL PRIMARY KEY,*/
	NGAYLAP DATETIME,	
	MAPHONG VARCHAR(10),
	TONGTIEN FLOAT,
	FOREIGN KEY(MAPHONG) REFERENCES PHONGSV(MAPHONG),
	MANV VARCHAR(20),
	FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
	TRANGTHAI NVARCHAR(20)
)

SELECT * FROM BANGGIADIENNUOC

CREATE TABLE CTHOADONDIENNUOC
(
	ID INT IDENTITY PRIMARY KEY,
	CHISOSUDUNG FLOAT,
	MABANGGIA VARCHAR(10),
	FOREIGN KEY (MABANGGIA) REFERENCES BANGGIADIENNUOC(MABANGGIA),
	MAHDDIENNUOC INT,
	FOREIGN KEY (MAHDDIENNUOC) REFERENCES HOADONDIENNUOC(MAHDDIENNUOC),
	/*PRIMARY KEY(MAHDDIENNUOC)*/
)

CREATE TABLE HOADONLEPHI
(
	MAHDLEPHI INT IDENTITY PRIMARY KEY,
	HANCUOI DATETIME,
	NGAYLAP DATETIME,
	TONGTIEN FLOAT,
	TRANGTHAI NVARCHAR,
	MANV VARCHAR(20),
	FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV),
	CCCD VARCHAR(13),
	FOREIGN KEY(CCCD) REFERENCES SINHVIEN(CCCD)
)

CREATE TABLE CTHOADONLEPHI
(
	ID INT IDENTITY PRIMARY KEY,
	SOTHANG INT,
	MAHDLEPHI INT,
	FOREIGN KEY(MAHDLEPHI) REFERENCES HOADONLEPHI(MAHDLEPHI),
	MAPHONG VARCHAR(10),
	FOREIGN KEY(MAPHONG) REFERENCES PHONGSV(MAPHONG)
)

CREATE TABLE ACCOUNT
(
    [USER] VARCHAR(32) NOT NULL,
    [PASS] VARCHAR(32) NOT NULL,
    QUYEN NVARCHAR(10) NOT NULL,
	MANV VARCHAR(20),
	CCCD VARCHAR(13),
    PRIMARY KEY([USER]),
	FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV),
	FOREIGN KEY (CCCD) REFERENCES SINHVIEN(CCCD)
)

INSERT INTO ACCOUNT([USER], [PASS], QUYEN) VALUES ('admin','admin','ADMIN')
INSERT INTO ACCOUNT([USER], [PASS], QUYEN) VALUES ('manager','manager','MANAGER')

select distinct TENPHONG from TOANHA,PHONGSV where TOANHA.MATOA = PHONGSV.MATOA
